<table class="table table-dark table-striped">
  <thead>
    <tr>
         <th scope="col">ID</th>
      <th scope="col">Away</th>
      <th scope="col">Score</th>
      <th scope="col">Home</th>
      <th scope="col">Score</th>
      <th scope="col">Quarter</th>
      <th scope="col">T/O (A)</th>
         <th scope="col">T/O (H)</th>
         <th scope="col">Bonus (A)</th>
         <th scope="col">Bonus (H)</th>
         <th scope="col">Game Clock</th>
         <th scope="col">Last Play</th>
         <th scope="col">Play Type</th>
         <th scope="col">Play Info</th>
        <th scope="col">Game State</th>
        <th scope="col">Free Throws</th>

    </tr>
  </thead>
  <tbody id="table_body">
    {% for match in matches %}
      <tr>
        <td id="id_{{ match.id }}">{{ match.id }}</td>
        <td id="away_{{ match.id }}">{{ match.away }}</td>
        <td id="a_score_{{ match.id }}">{{ match.a_score }}</td>
        <td id="home_{{ match.id }}">{{ match.home }}</td>
        <td id="h_score_{{ match.id }}">{{ match.h_score }}</td>
        <td id="time_{{ match.id }}">{{ match.time }}</td>
      <td id="a_to_{{ match.id }}">{{ match.a_to }}</td>
      <td id="h_to_{{ match.id }}">{{ match.h_to }}</td>
      <td id="a_bonus_{{ match.id }}">{{ match.a_bonus }}</td>
      <td id="h_bonus_{{ match.id }}">{{ match.h_bonus }}</td>
      <td id="clock_{{ match.id }}">{{ match.clock }}</td>
      <td id="state_{{ match.id }}">{{ match.state }}</td>
      <td id="desc_{{ match.id }}">{{ match.desc }}</td>
      <td id="detail_{{ match.id }}">{{ match.detail }}</td>
      <td id="gstype_{{ match.id }}">{{ 0 }}</td>
      <td id="free_{{ match.id }}">{{ 0 }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
<script>

     function checkPeriod(i){
        console.log(i, "period");
        var to_team = document.querySelectorAll('[id^="home_"]');
        var startend = document.querySelectorAll('[id^="desc_"]');
        var period = document.querySelectorAll('[id^="time_"]')
            msg = startend[i].textContent;
            if(msg == "start" || msg == "end"){
                speakPeriod(to_team[i].textContent, startend[i].textContent, period[i].textContent);
            }

    };

    function checkTimeout(i2){
        var timeouts = document.querySelectorAll('[id^="state_"]');
        var to_team = document.querySelectorAll('[id^="detail_"]');
            msg = timeouts[i2].textContent;
            console.log(msg);
            if(msg == "timeout"){
                speakTimeout(to_team[i2].textContent);
            }

    };
    function speakPeriod(t,se,pe){
        switch (t) {
  case 'ATL':
    team = "hawks";
    break;
  case 'BOS':
    team = "celtics";
    break;
  case 'BKN':
     team = "nets";
    break;
  case 'CHI':
    team = "bulls";
    break;
  case 'CHA':
    team = "hornets";
    break;
  case 'CLE':
    team = "cavs";
    break;
  case 'DET':
    team = "pistons";
    break;
  case 'IND':
    team = "pacers";
    break;
  case 'MIA':
     team = "heat";
    break;
  case 'MIL':
    team = "bucks";
    break;
  case 'NYK':
    team = "nicks";
    break;
  case 'ORL':
    team = "magic";
    break;
  case 'PHI':
    team = "sixers";
    break;
  case 'TOR':
    team = "raptors";
    break;
  case 'WAS':
     team = "wizards";
    break;
  case 'DAL':
    team = "mavs";
    break;
  case 'DEN':
    team = "nuggets";
    break;
  case 'GSW':
    team = "warriors";
    break;
  case 'HOU':
    team = "rockets";
    break;
  case 'LAC':
    team = "clippers";
    break;
  case 'LAL':
     team = "lakers";
    break;
  case 'MEM':
    team = "grizzlies";
    break;
  case 'NOP':
    team = "pelicans";
    break;
  case 'OKC':
    team = "thunder";
    break;
  case 'PHO':
    team = "suns";
    break;
  case 'POR':
    team = "blazers";
    break;
  case 'SAC':
     team = "kings";
    break;
  case 'SAS':
    team = "spurs";
    break;
  case 'UTA':
    team = "jazz";
    break;


}
        console.log(team);
        let text = team + pe + " period " + se;
        let utterance = new SpeechSynthesisUtterance(text);
        speechSynthesis.speak(utterance);
        speechSynthesis.speak(utterance);
        speechSynthesis.speak(utterance);
        console.log(text)

    };
    function speakTimeout(t){
        switch (t) {
  case 'ATL Timeout':
    team = "hawks";
    break;
  case 'BOS Timeout':
    team = "celtics";
    break;
  case 'BKN Timeout':
     team = "nets";
    break;
  case 'CHI Timeout':
    team = "bulls";
    break;
  case 'CHA Timeout':
    team = "hornets";
    break;
  case 'CLE Timeout':
    team = "cavs";
    break;
  case 'DET Timeout':
    team = "pistons";
    break;
  case 'IND Timeout':
    team = "pacers";
    break;
  case 'MIA Timeout':
     team = "heat";
    break;
  case 'MIL Timeout':
    team = "bucks";
    break;
  case 'NYK Timeout':
    team = "nicks";
    break;
  case 'ORL Timeout':
    team = "magic";
    break;
  case 'PHI Timeout':
    team = "sixers";
    break;
  case 'TOR Timeout':
    team = "raptors";
    break;
  case 'WAS Timeout':
     team = "wizards";
    break;
  case 'DAL Timeout':
    team = "mavs";
    break;
  case 'DEN Timeout':
    team = "nuggets";
    break;
  case 'GSW Timeout':
    team = "warriors";
    break;
  case 'HOU Timeout':
    team = "rockets";
    break;
  case 'LAC Timeout':
    team = "clippers";
    break;
  case 'LAL Timeout':
     team = "lakers";
    break;
  case 'MEM Timeout':
    team = "grizzlies";
    break;
  case 'NOP Timeout':
    team = "pelicans";
    break;
  case 'OKC Timeout':
    team = "thunder";
    break;
  case 'PHX Timeout':
    team = "suns";
    break;
  case 'POR Timeout':
    team = "blazers";
    break;
  case 'SAC Timeout':
     team = "kings";
    break;
  case 'SAS Timeout':
    team = "spurs";
    break;
  case 'UTA Timeout':
    team = "jazz";
    break;


}
        let text = team + " timeout";
        let utterance = new SpeechSynthesisUtterance(text);
        speechSynthesis.speak(utterance);
        speechSynthesis.speak(utterance);
        speechSynthesis.speak(utterance);

        console.log(text)

    };
  setInterval(function() {
      fetch('/data_json').then(
        response => response.json()
      ).then(
        data =>
          data.forEach(match =>
            updateElement(match)
          )
      )
    }, 1000
  );

function updateElement(match) {

    Object.entries(match).forEach(([k,v]) => {
        element = document.getElementById(k + "_" + match.id);
        // Get Previous value first
        previousValue = element.innerHTML;

        // If Previous value is not equal to the new value, change it!


        if (previousValue !== v.toString()) {

            blinkUpdate(element, v.toString());
            if (k == "state") {
                if (v.toString()=="timeout") {
                    checkTimeout(match.id-1,"timeout");
                    blinkUpdate(document.getElementById("gstype_" + match.id),"timeout");
                } else if (v.toString()=="timeout") {
                     blinkUpdate(document.getElementById("gstype_" + match.id),"between period");
                } else if (v.toString()!="substitution") {
                     blinkUpdate(document.getElementById("gstype_" + match.id)," - ");
                }

            }
            if (k == "desc") {
                if (v.toString()=="start") {
                    checkPeriod(match.id-1);
                    console.log(v.toString());
                }
            }
        }
    })
}

function blinkUpdate(element, newValue, newColor='#00ff00') {
    previousColor = element.style.color;
    element.innerHTML = newValue;
    element.style.color = newColor;

    // Set back to original color after timeout ms
    setTimeout(() => {
        element.style.color = previousColor
    }, 2000)
}
</script>